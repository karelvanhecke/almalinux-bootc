releasever: 9
variables:
  distro: "almalinux"

repos:
  - baseos
  - appstream

metadata:
  name: almalinux-boot-tier1
  summary: AlmaLinux Bootable Tier 1

include:
  - fedora-bootc/tier-1/manifest.yaml
  - fedora-bootc/tier-1/kernel.yaml

packages:
  - dnf-yum

exclude-packages:
  - subscription-manager

add-files:
  - - bootc-install.toml
    - /usr/lib/bootc/install/10-defaults.toml
  - - cosign.pub
    - /etc/pki/containers/ghcr.io-karelvanhecke-bootc.pub
  - - containers-policy.json
    - /etc/containers/policy.json
  - - containers-registry.yaml
    - /etc/containers/registries.d/ghcr.io-karelvanhecke-bootc.yaml
  - - containers-registry-toolbox.yaml
    - /etc/containers/registries.d/quay.io-toolbx-images.yaml
  - - cosign-toolbox.pub
    - /etc/pki/containers/quay.io-toolbx-images.pub

postprocess:
  - |
    #!/usr/bin/env bash
    set -xeo pipefail

    sed -i 's,image = "registry.access.redhat.com/ubi9/toolbox:latest",image = "quay.io/toolbx-images/almalinux-toolbox:9",' /etc/containers/toolbox.conf
